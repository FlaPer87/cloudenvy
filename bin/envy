#!env python
# vim: tabstop=4 shiftwidth=4 softtabstop=4

import argparse
import logging
import sys

from cloudenvy import fabfile


if __name__ == '__main__':
    parser = argparse.ArgumentParser(
            description='Launch a virtual machine in an openstack environment.')
    parser.add_argument('-v', '--verbosity', action='count',
                        help='increase output verbosity')
    subparsers = parser.add_subparsers(title='Available commands:')

    for cmd in fabfile.COMMANDS:
        helptext = getattr(cmd, '__docstring', '')
        subparser = subparsers.add_parser(cmd.func_name, help=helptext)
        subparser.set_defaults(func=cmd)

    args = parser.parse_args()

    if args.verbosity == 3:
        logging.getLogger().setLevel(logging.DEBUG)
        logging.getLogger('novaclient').setLevel(logging.DEBUG)
    elif args.verbosity == 2:
        logging.getLogger().setLevel(logging.DEBUG)
        logging.getLogger('novaclient').setLevel(logging.INFO)
    elif args.verbosity == 1:
        logging.getLogger().setLevel(logging.INFO)

    args.func()
